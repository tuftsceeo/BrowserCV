<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Our CSS -->
        <link href="../style.css" rel="stylesheet" />

        <!-- Bootstrap CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
            crossorigin="anonymous"
        />
    </head>
    
    <body>
        <!-- Bootstrap JavaScript -->
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous"
        ></script>
        
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="../index.html">BrowserCV</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
    
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="../index.html">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../Generate Code Tool/tool.html">Tool</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="../Help/help.html">Help</a>
                </li>
            </div>
            </nav>

            
        <!-- Page Content -->
        <div class="container-fluid">
            <!-- Header -->
            <div class="row help-section">
                <div class="col">
                    <h1>How to use BrowserCV</h1>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-5">
                    <!-- Tool Page -->
                    <div class="row row-help-section">
                        <h3 id="tool_page">The Tool Page</h3>
                        <p>
                            Use the <a href="../Generate Code Tool/tool.html">tool</a> page to explore pre-made image processing functions and create a combination that does what you want.
                        </p>
                        <p>
                            Click the <b>Start Video</b> and <b>Start Processing</b> buttons if the input and output video streams don't start automatically.
                        </p>
                        <p>
                            Click on the buttons below the videos to add an image processing function <b>step</b> to the queue of functions. Each step is applied to images sequentially before they are shown. Some steps have outputs. Change the values used for each step if the option is available.
                        </p>
                        <p>
                            Click the <b>X</b> button on a step to remove it, or use the red buttons at the top of the queue to remove the last added step or to clear the queue.
                        </p>
                        <p>
                            When you're done with your function, choose a programming language and click the <b>Generate Code</b> button. This automatically generates code in that language which applies the function created which you can then copy and paste into your own project.
                        </p>
                        <p>
                            The code generated always includes the primary <b>processImage</b> function, and may also include various helper functions which processImage uses. The processImage function can always be found at the bottom of the code.
                        </p>
                        <p>
                            The outputs of the steps selected will always be returned from the processImage function. These outputs are an object, and can be selected from the object using the ID of the function generating the output you want. The specifics of syntax may depend on the language you're using.
                        </p>
                    </div>

                    <!-- Setup in various languages -->
                    <div class="row row-help-section">
                            <h3 id="cv_setup">Computer Vision Project Setup</h3>
                            <!-- HTML & JS -->
                            <div class="row row-help-subsection">
                                <h5 id="html">HTML & Javascript</h5>
                                <p>
                                    To use the functions generated by BrowserCV for a webpage, there are a few things that need to be setup.
                                </p>
                                <p>
                                    First, the following HTML must exist within the &lt;head&gt; tag of your page (or alternatively do <a href="https://docs.opencv.org/3.4/d0/d84/tutorial_js_usage.html">this</a>):
                                    <div class="code-highlight">
                                        <pre>
                                            <code>
&lt;script type="text/javascript" src="https://docs.opencv.org/master/opencv.js"&gt;&lt;/script&gt;</code>
                                        </pre>
                                    </div>
                                </p>
                                <p>
                                    Next, you'll need to get an image in a cv.Mat() class. You can find several ways to do this on the <a href="https://docs.opencv.org/3.4/d5/d10/tutorial_js_root.html">opencv.js tutorials</a>, or follow this method to use a webcam. First create <code>&lt;video id="video"&gt;</code> and <code>&lt;canvas id="dst"&gt;</code> tags on your page, then start streaming video from a webcam to the <code>&lt;video&gt;</code> tag when this script is run:
                                    <div class="code-highlight">
                                        <pre>
                                            <code>
const video = document.getElementById("YOUR_VIDEO_TAG_ID");
// Set the width and height of the video tag (in pixels)
video.setAttribute("width", 320);
video.setAttribute("height", 240);
// Get access to the camera
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
    navigator.mediaDevices
        .getUserMedia({ video: true })
        .then(function (stream) {
            video.srcObject = stream;
            video.play();
        });
}</code>
                                        </pre>
                                    </div>
                                </p>
                                <p>
                                    Sample an image from the video and put it in a cv.Mat() class using this script. Don't forget to run <code>img.delete()</code> when you're done using the image.
                                    <div class="code-highlight">
                                        <pre>
                                            <code>
const video = document.getElementById("YOUR_VIDEO_TAG_ID");
const cap = new cv.VideoCapture(video);
let img = new cv.Mat(video.height, video.width, cv.CV_8UC4);
cap.read(img);</code>
                                        </pre>
                                    </div>
                                </p>
                                <p>
                                    Finally, run the image through your processing function (and don't forget to define it and helper functions by copying their code from <a href="../Generate Code Tool/tool.html">the tool</a>) and display it in the canvas we created above:
                                    <div class="code-highlight">
                                        <pre>
                                            <code>
processImage(img);
cv.imshow("YOUR_CANVAS_TAG_ID", img);
img.delete();</code>
                                        </pre>
                                    </div>
                                </p>  
                            </div>

                            <!-- Python -->
                            <div class="row row-help-subsection">
                                <h5 id="python">Python</h5>
                                <p>
                                    To use an image processing function in Python, first you need to download the OpenCV-Python library. I won't go into the details too much here, but if not using a Python environment (like <a href="https://blog.hubspot.com/website/anaconda-python">Anaconda</a>), <a href="https://docs.opencv.org/4.x/d5/de5/tutorial_py_setup_in_windows.html">this tutorial</a> contains the basics.
                                </p>
                                <p>
                                    Next, import the OpenCV module using:
                                    <div class="code-highlight">
                                        <pre>
                                            <code>
import cv2 as cv
print(cv.__version__) # Currently 4.5.5
# Other useful packages for working with OpenCV, but not needed
# import numpy as np
# import matplotlib as mpl
# import matplotlib.pyplot as plt
# import sys
# import os
</code>
                                        </pre>
                                    </div>
                                </p>
                                <p>
                                    Then, define your image processing function (copied from <a href="../Generate Code Tool/tool.html">the tool</a>):
                                    <div class="code-highlight">
                                        <pre>
                                            <code>
# Takes in variable containing openCV image and returns
# a tuple of its modified version and outputs (img, outputs)
def processImage(img, input_width, input_height):
    # Setup
    outputs = {}
    
    # --- The tool will generate more code here! ---

    # Return outputs of sub functions
    return img, outputs
</code>
                                        </pre>
                                    </div>
                                </p>
                                <p>
                                    Next, you'll want to start a video capture. The method below worked for connecting to my webcam and displaying output to a new window on my PC, but may not work in all cases. More information for capturing a video input can be found <a href="https://docs.opencv.org/3.4/d8/dfe/classcv_1_1VideoCapture.html#details">here</a>.
                                    <div class="code-highlight">
                                        <pre>
                                            <code>
# Setup
input_width = 320 # Change to fit your
input_height = 240 # video dimensions

# Get video
cap = cv.VideoCapture(0)
cap.set(cv.CAP_PROP_FRAME_WIDTH, input_width)
cap.set(cv.CAP_PROP_FRAME_HEIGHT, input_height)

# Check if it opened
if not cap.isOpened():
    print("Can't open camera")
    exit()</code>
                                        </pre>
                                    </div>
                                </p>
                                <p>
                                    You can check the width and height of your output code using these commands:
                                    <div class="code-highlight">
                                        <pre>
                                            <code>
print(cap.get(cv.CAP_PROP_FRAME_WIDTH))
print(cap.get(cv.CAP_PROP_FRAME_HEIGHT))</code>
                                        </pre>
                                    </div>
                                </p>
                                <p>
                                    Now we're ready to apply our image processing function! The script below displays the post-processed image to a new window on my desktop and prints the outputs of all my functions in Python. Pressing 'q' on a keyboard closes the window and exits the program. This script outline shows how to use the image processing function generated from <a href="../Generate Code Tool/tool.html">the tool</a>.
                                    <div class="code-highlight">
                                        <pre>
                                            <code>
keep_going = True
while keep_going:
    # Capture frame-by-frame
    worked, frame = cap.read() # Frame contains the image.
                               # If frame is read correctly, then
                               # worked (a boolean) is True
    
    if worked:
        # Apply our image processing function
        frame, outputs = processImage(frame, input_width, input_height)
        
        # Here I'm just showing the image,
        # but you could do more with it
        cv.imshow('frame', frame)
        
        # Here I'm just printing outputs,
        # but you could do more with this as well
        print(outputs)
        
        # Here I have an exit condition
        # When the 'q' key is pressed, everything stops
        if cv.waitKey(100) == ord('q'):
            keep_going = False
    else:
        print("Can't receive frame (stream end?). Exiting ...")
        keep_going = False
</code>
                                        </pre>
                                    </div>
                                </p>
                                <p>
                                    Finally, we clean up our script, making sure all windows are closed and we close the capture correctly
                                    <div class="code-highlight">
                                        <pre>
                                            <code>
# Clean up
cap.release() # Lets other apps use your webcam
cv.destroyAllWindows() # Exits the window Python opens</code>
                                        </pre>
                                    </div>
                                </p>

                            </div>

                        <!-- Examples -->
                        <div class="row row-help-section">
                            <h3 id="examples">Examples</h3>
                            <div>
                                <h5 id="left_or_right">Left or Right</h5>
                                <p>
                                    One possible image processing function that can be generated using this tool will determine if an object of a certain color is on the left or the right half of the screen. For this example, we'll be looking for a red circle.
                                </p>
                                <p>
                                    First, we'll use a threshold function to look for objects which are more red than they are other colors. This will help us block out bright white objects. Click the "Add threshold" button, make sure the type is binary, and adjust the slider until your object looks red and other (non-red) objects don't.
                                </p>
                                <p>
                                    Next, we'll look for a red object by adding a "find color" step using the "Add find color" button on the tool. Set the color to find to be red, the maximum number of objects to look for to be 1, and make sure the visualize circles box is checked. Hold the red object in front of your camera and adjust the brightness, minimum size, and maximum size settings until the function correctly circles the red object and doesn't circle any other objects. Increasing the minimum size may help stop small noise fluctuations from being identified as an object.
                                </p>
                                <p>
                                    Lastly, click the "Add is object in grid" button to add a step looking for where an object is on the image. Set the "use output from" box to be the ID of the findColor step we just added and pick a grid width of 2 and height of 1. Have the function add 1 to the total if the object is in the left grid box, and -1 if it's in the right.
                                </p>
                                <p>
                                    Observe the number next to total at the bottom of the "is object in grid" function. If the object is on the left side of the image, the total will be 1. If it's on the right, the total will be -1. If the object is not visible, the total will be 0.
                                </p>
                                <p>
                                    Finally, select which language you're using and click "generate code" at the bottom of the website. Copy and paste the results into your program. You can access the total generated in the last step by looking in the "outputs" object generated by the processImage function under the ID of the "is object in grid" step. 
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Table of contents -->
                <div class="col">
                    <div class="sticky help-toc">
                        <div class="row">
                            <div class="col d-flex justify-content-center">
                                <h4>Table of contents:</h4>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col d-flex justify-content-center">
                                <ul>
                                    <li><a href="#tool_page">The Tool Page</a></li>
                                    <li><a href="#cv_setup">Computer Vision Project Setup</a>
                                        <ul>
                                            <li><a href="#html">HTML & JavaScript</a></li>
                                            <li><a href="#python">Python</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="#examples">Examples</a>
                                        <ul>
                                            <li><a href="#left_or_right">Left or Right</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>


    </body>
</html>